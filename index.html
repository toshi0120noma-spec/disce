<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dice Fortune | げーまー哲</title>
<style>
  :root{
    --accent:#24AAED;                /* STUDIOのブランド色に合わせて変更可 */
    --bg:#ffffff;                    /* 背景色（透過させたい時は transparent も可）*/
    --ink:#0a0a0a;
    --soft:#f3f6f9;
    --radius:18px;
    --shadow:0 10px 30px rgba(0,0,0,.08);
  }

  html,body{height:100%;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI","Yu Gothic",Meiryo,sans-serif;}
  .wrap{max-width:880px;margin:0 auto;padding:24px}
  .card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}
  .head{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;}
  .title{font-weight:800;font-size:clamp(18px,3.2vw,22px);}
  .sub{opacity:.7;font-size:13px}
  .modes{display:flex;gap:8px;flex-wrap:wrap}
  .chip{border:1px solid #e6e9ee;border-radius:999px;padding:8px 14px;background:#fff;cursor:pointer;font-weight:700;font-size:14px}
  .chip[aria-pressed="true"]{background:var(--accent);color:#fff;border-color:var(--accent)}
  .stage{margin:16px 0;border-radius:var(--radius);background:var(--soft);padding:22px;display:grid;grid-template-columns:1fr;gap:18px}
  .die-area{display:grid;place-items:center;height:280px;position:relative;overflow:hidden;border-radius:14px;background:radial-gradient(1200px 400px at 50% 0%, rgba(36,170,237,.15), transparent)}

  /* 画像でダイスを表示（背景画像） */
  .die{
    width: min(42vw, 260px);
    height: min(42vw, 260px);
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    will-change: transform, filter;
    transition: transform .8s cubic-bezier(.2,.7,.2,1), filter .2s;
    transform-style: preserve-3d;
    filter: drop-shadow(0 14px 28px rgba(0,0,0,.18));
  }

  /* 回転アニメ（擬似3D） */
  .die.spin{
    animation: spinY .8s cubic-bezier(.2,.7,.2,1);
  }
  @keyframes spinY{
    0%   { transform: rotateX(8deg) rotateY(0deg) scale(1);   filter: drop-shadow(0 8px 18px rgba(0,0,0,.14)); }
    50%  { transform: rotateX(8deg) rotateY(360deg) scale(1.06); filter: drop-shadow(0 20px 34px rgba(0,0,0,.22)); }
    100% { transform: rotateX(8deg) rotateY(720deg) scale(1); }
  }

  .badge{position:absolute;top:14px;left:14px;background:#fff;border-radius:999px;padding:6px 10px;font-weight:800;font-size:12px;border:1px solid #e8edf3}
  .result{display:grid;gap:6px}
  .result h3{margin:0;font-size:clamp(18px,3.4vw,22px)}
  .result p{margin:0;color:#444;line-height:1.8}
  .actions{display:flex;gap:10px;flex-wrap:wrap}
  .btn{border:none;border-radius:10px;padding:12px 18px;font-weight:800;cursor:pointer}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.ghost{background:#fff;border:1px solid #e6e9ee}
  .note{font-size:12px;opacity:.7;margin-top:6px}
  .footer{margin-top:10px;font-size:12px;opacity:.7;text-align:right}
  @media (min-width:760px){
    .stage{grid-template-columns:1.1fr 1fr}
    .die-area{height:320px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div>
          <div class="title">DICE FORTUNE / ダイスおみくじ</div>
          <div class="sub">“音と物語を創る焼うどん系VTuber・げーまー哲”の遊べるコーナー</div>
        </div>
        <div class="modes" role="group" aria-label="ダイスの種類">
          <button class="chip" data-sides="4"  aria-pressed="false">d4</button>
          <button class="chip" data-sides="6"  aria-pressed="false">d6</button>
          <button class="chip" data-sides="8"  aria-pressed="false">d8</button>
          <button class="chip" data-sides="12" aria-pressed="false">d12</button>
          <button class="chip" data-sides="20" aria-pressed="true">d20</button>
        </div>
      </div>

      <div class="stage">
        <div class="die-area">
          <span class="badge" id="badge">d20</span>
          <div class="die" id="die" aria-live="polite"></div>
        </div>
        <div class="result">
          <h3 id="headline">ダイスを振ってみよう！</h3>
          <p id="desc">下のボタンを押すと、選んだダイスで結果が出ます。結果に合わせて“運勢コメント”も表示されます。</p>
          <div class="actions">
            <button class="btn primary" id="rollBtn">ダイスを振る</button>
            <button class="btn ghost" id="shareBtn" title="結果の共有リンクをコピー">結果リンクをコピー</button>
          </div>
          <div class="note">※演出はおみくじ用の軽いアニメーションです。TRPGの公式ロールではありません。</div>
        </div>
      </div>

      <div class="footer">© Gamer Tetsu</div>
    </div>
  </div>

<script>
  // ===== テーマ色をURLパラメータから変更 ?accent=%23ff7a00 など =====
  const params = new URLSearchParams(location.search);
  if(params.get('accent')) document.documentElement.style.setProperty('--accent', params.get('accent'));

  // 要素取得
  const chips    = document.querySelectorAll('.chip');
  const badge    = document.getElementById('badge');
  const dieEl    = document.getElementById('die');
  const headline = document.getElementById('headline');
  const desc     = document.getElementById('desc');
  const rollBtn  = document.getElementById('rollBtn');
  const shareBtn = document.getElementById('shareBtn');

  // 画像の場所を設定（必ず img/ にPNGを置いてください）
  const diceImages = {
    4:  'img/d4.png',
    6:  'img/d6.png',
    8:  'img/d8.png',
    12: 'img/d12.png',
    20: 'img/d20.png'
  };

  // 画像プリロード（チラつき防止）
  Object.values(diceImages).forEach(src => { const i = new Image(); i.src = src; });

  // 初期値
  let sides = 20;

  function updateDieImage(){
    dieEl.style.backgroundImage = `url(${diceImages[sides]})`;
    badge.textContent = 'd' + sides;
  }

  // ダイス種類の切り替え
  chips.forEach(ch => ch.addEventListener('click', () => {
    chips.forEach(c => c.setAttribute('aria-pressed','false'));
    ch.setAttribute('aria-pressed','true');
    sides = Number(ch.dataset.sides);
    updateDieImage();
    headline.textContent = 'ダイスを選びました：d' + sides;
    desc.textContent = '「ダイスを振る」を押して結果を出しましょう。';
    history.replaceState({},'',location.pathname + '?s=' + sides);
  }));

  // おみくじメッセージ
  const fortuneText = (n, s) => {
    if (s === 20){
      if (n === 20) return ['クリティカル！大吉','行動あるのみ。今日のあなたは主役。'];
      if (n >= 16) return ['大吉','流れが来てます。難しめクエストにも挑戦を。'];
      if (n >= 11) return ['中吉','堅実に。準備を整えれば勝率アップ。'];
      if (n >= 6)  return ['小吉','無理せず基礎を固める日。休憩も大事。'];
      if (n === 1) return ['ファンブル…','急ぎは禁物。今日はセーブをこまめに。'];
      return ['末吉','まずは手持ちのタスクからコツコツ。'];
    } else {
      const ratio = n / s;
      if (ratio > .9) return ['大吉','願ってた展開が来るかも。リアクションは早めに！'];
      if (ratio > .6) return ['中吉','良き兆し。調整力を大切に。'];
      if (ratio > .3) return ['小吉','焦らず、回数で当てに行こう。'];
      return ['凶','今日は安全運転。無理な突撃は控えめに。'];
    }
  };

  // 振る（画像は回転、数字はテキストで表示）
  function roll(){
    dieEl.classList.remove('spin'); void dieEl.offsetWidth; dieEl.classList.add('spin');

    const spins = 18 + Math.floor(Math.random()*10);
    let tick = 0, last = 1;

    const timer = setInterval(()=>{
      last = 1 + Math.floor(Math.random()*sides); // 中間演出で内部だけ更新
      if(++tick >= spins){
        clearInterval(timer);
        const n = 1 + Math.floor(Math.random()*sides); // 最終確定
        const [h, d] = fortuneText(n, sides);
        headline.textContent = `結果：${n}（d${sides})  —  ${h}`;
        desc.textContent = d;

        const url = new URL(location.href);
        url.searchParams.set('s', sides);
        url.searchParams.set('r', n);
        history.replaceState({},'',url);
      }
    }, 45);
  }

  // 共有リンク
  function share(){
    const ok = () => {
      shareBtn.textContent = 'コピーしました！';
      setTimeout(()=> shareBtn.textContent='結果リンクをコピー', 1600);
    }
    navigator.clipboard?.writeText(location.href).then(ok, ok);
  }

  // 初期状態：URLから復元
  (function initFromURL(){
    const s = Number(params.get('s'));
    const r = Number(params.get('r'));
    if (s && [4,6,8,12,20].includes(s)){
      sides = s;
      chips.forEach(c => c.setAttribute('aria-pressed', c.dataset.sides==s ? 'true' : 'false'));
    }
    updateDieImage();
    if (r && r>=1 && r<=sides){
      const [h, d] = fortuneText(r, sides);
      headline.textContent = `結果：${r}（d${sides})  —  ${h}`;
      desc.textContent = d;
    }
  })();

  rollBtn.addEventListener('click', roll);
  shareBtn.addEventListener('click', share);
</script>
</body>
</html>

